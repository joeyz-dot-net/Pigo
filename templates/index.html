<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
	
	<!-- Primary Metadata -->
	<title>é£çŒªéŸ³ä¹ - å¯ä»¥åœ¨æµè§ˆå™¨ä¸­åå°æ’­æ”¾çš„ç½‘ç»œæ’­æ”¾å™¨</title>
	<meta name="description" content="ClubMusic - å¯ä»¥åœ¨æµè§ˆå™¨ä¸­åå°æ’­æ”¾çš„ç½‘ç»œæ’­æ”¾å™¨" />
	<meta name="keywords" content="éŸ³ä¹,ç‚¹æ’­,ä¸²æµ,mp3,flac,wav,ClubMusic" />
	
	<!-- Open Graph -->
	<meta property="og:type" content="website" />
	<meta property="og:title" content="é£çŒªéŸ³ä¹ - å¯ä»¥åœ¨æµè§ˆå™¨ä¸­åå°æ’­æ”¾çš„ç½‘ç»œæ’­æ”¾å™¨" />
	<meta property="og:site_name" content="é£çŒªéŸ³ä¹" />
	<meta property="og:url" content="{{ request.url }}" />
	<meta property="og:description" content="é£çŒªéŸ³ä¹ - å¯ä»¥åœ¨æµè§ˆå™¨ä¸­åå°æ’­æ”¾çš„ç½‘ç»œæ’­æ”¾å™¨" />
	<meta property="og:image" content="/static/images/preview.png" />
	<meta property="og:image:secure_url" content="/static/images/preview.png" />
	<meta property="og:image:width" content="1200" />
	<meta property="og:image:height" content="630" />
	<meta property="og:image:alt" content="ClubMusicé¢„è§ˆå›¾" />
	<link rel="image_src" href="/static/images/preview.png" />
	<!-- Favicon -->
	<link rel="icon" type="image/x-icon" href="/static/images/favicon.ico" />
	<link rel="shortcut icon" href="/static/images/favicon.ico" />
		
	<!-- Compatibility -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="renderer" content="webkit" />
	<!-- CSS Stylesheets -->
	<link rel="stylesheet" href="/static/css/base.css?v=1" />
	<!-- è°ƒè¯•é¢æ¿æ¨¡å— CSS -->
	<!-- ä¸»é¢˜ CSS å°†ç”± themeManager åŠ¨æ€åŠ è½½ -->
	<link rel="stylesheet" href="/static/css/responsive.css?v=1" />
	<!-- è®¾ç½®é¢æ¿ CSS -->
	<link rel="stylesheet" href="/static/css/settings.css?v=1" />
	<style>
		.footer {
			height: calc(100% - (2/5 * 100%));
		}
		
		/* ç¦æ­¢é¡µé¢æ‹–æ‹½ç§»åŠ¨ */
		html, body {
			position: fixed;
			overflow: hidden;
			width: 100%;
			height: 100%;
		}
	</style>
</head>
<body>
	<script id="boot-data" type="application/json">{{ {'tree': tree, 'musicDir': music_dir}|tojson }}</script>
	<main id="tree" class="tab-content local-tab bright-theme" aria-label="æ–‡ä»¶åˆ—è¡¨">
		<div id="localContent" class="local-content"></div>
	</main>
	<div id="playlist" class="tab-content playlist-tab" aria-label="æ’­æ”¾åˆ—è¡¨">
		
		<div id="youtubeSearchResults" class="youtube-search-results" style="display:none;">
			<h4 class="youtube-search-title">æœç´¢ç»“æœ</h4>
			<div id="youtubeSearchList" class="youtube-search-list"></div>
		</div>
		
		<div class="play-list-section" id="playListSection">
			<div id="playListContainer" class="play-list-container"></div>
		</div>
		<!-- YouTubeæœç´¢ç»“æœæ¨¡æ€æ¡† -->
		<div id="youtubeSearchModal" class="youtube-search-modal" style="display:none;">
			<div class="youtube-search-modal-content">
				<div class="youtube-search-modal-header">
					<h3>æœç´¢ç»“æœ</h3>
					<button class="youtube-search-modal-close" data-icon="âœ•">âœ•</button>
				</div>
				<div class="youtube-search-modal-body">
					<div id="youtubeSearchModalList" class="youtube-search-modal-list"></div>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Full Screen Player Modal -->
	<div id="fullPlayer" class="full-player" style="display:none;">
		<div class="full-player-content">
			<!-- Album Art -->
			<div class="full-player-artwork">
				<div class="full-player-artwork-container">
					<img id="fullPlayerCover" src="" alt="ä¸“è¾‘å°é¢" onerror="this.style.display='none';" loading="eager" decoding="async" />
					<div class="full-player-artwork-placeholder" id="fullPlayerPlaceholder">ğŸµ</div>
				</div>
			</div>

			<!-- Song Info -->
			<div class="full-player-info">
				<div class="full-player-title" id="fullPlayerTitle">æœªæ’­æ”¾</div>
				
				<div class="full-player-playlist" id="fullPlayerPlaylist">æ­£åœ¨æ’­æ”¾</div>
			</div>

			<!-- Progress Bar -->
			<div class="full-player-progress-section">
				<div class="full-player-progress-bar" id="fullPlayerProgressBar">
					<div class="full-player-progress-fill" id="fullPlayerProgressFill"></div>
					<div class="full-player-progress-thumb" id="fullPlayerProgressThumb"></div>
				</div>
				<div class="full-player-time">
					<span id="fullPlayerCurrentTime">0:00</span>
					<span id="fullPlayerDuration">0:00</span>
				</div>
			</div>

			<!-- Controls -->
			<div class="full-player-controls">
				<button class="full-player-control-btn full-player-shuffle" id="fullPlayerShuffle" title="éšæœºæ’­æ”¾">
					<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5"/>
					</svg>
				</button>
				<button class="full-player-control-btn full-player-prev" id="fullPlayerPrev" title="ä¸Šä¸€é¦–">
					<svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
						<path d="M16 6h2v12h-2V6zM8 12l8.5-6v12L8 12z"/>
					</svg>
				</button>
				<button class="full-player-control-btn full-player-play-pause" id="fullPlayerPlayPause" title="æ’­æ”¾/æš‚åœ">
					<svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
						<path d="M8 5v14l11-7z"/>
					</svg>
				</button>
				<button class="full-player-control-btn full-player-next" id="fullPlayerNext" title="ä¸‹ä¸€é¦–">
					<svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
						<path d="M6 6h2v12H6V6zm10 6l-8.5 6V6L16 12z"/>
					</svg>
				</button>
				<button class="full-player-control-btn full-player-repeat" id="fullPlayerRepeat" title="å¾ªç¯æ¨¡å¼">
					<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path d="M17 1l4 4-4 4M3 11V9a4 4 0 0 1 4-4h14M7 23l-4-4 4-4M21 13v2a4 4 0 0 1-4 4H3"/>
					</svg>
				</button>
			</div>

			<!-- Volume Control -->
			<div class="full-player-volume">
				<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
					<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
				</svg>
				<div class="full-player-volume-slider">
						<input type="range" id="fullPlayerVolumeSlider" min="1" max="50" value="25" />	
						<div id="fullPlayerVolumeDisplay" class="volume-display" style="display:none;">
						<span class="volume-value">25</span>
					</div>				</div>
				<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
					<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
				</svg>
			</div>

		</div>
	</div>

	<!-- Mini Player å·²ç§»é™¤ -->
	
	<!-- Bottom Navigation (ç®€åŒ–ç‰ˆï¼šé˜Ÿåˆ—ã€æœç´¢ã€è®¾ç½®) -->
	<nav id="bottomNav" class="bottom-nav">
		<button class="nav-item active" data-tab="playlists">
			<span class="nav-icon">ğŸµ</span>
		</button>
		<button class="nav-item" data-tab="search">
			<span class="nav-icon">ğŸ”</span>
		</button>
		<button class="nav-item" id="settingsNavBtn" title="è®¾ç½®">
			<span class="nav-icon">âš™ï¸</span>
		</button>
	</nav>

	<!-- æµ®åŠ¨æ¨æµæŒ‡ç¤ºå™¨ï¼šåº•éƒ¨å¯¼èˆªä¸Šæ–¹å±…ä¸­ -->
	<div id="floating-stream-indicator" style="
		position: fixed;
		left: 50%;
		transform: translateX(-50%);
		bottom: 58px; /* åœ¨åº•éƒ¨å¯¼èˆªä¹‹ä¸Šï¼Œç¨åä¸Šä¸€ç‚¹ */
		z-index: 1200;
		background: rgba(20,20,20,0.9);
		color: #ddd;
		padding: 6px 10px;
		border-radius: 18px;
		display: flex;
		align-items: center;
		gap: 8px;
		box-shadow: 0 4px 12px rgba(0,0,0,0.4);
		font-size: 13px;
		">
		<span id="floating-stream-dot" style="width:10px;height:10px;border-radius:50%;background:#777;display:inline-block;"></span>
		<span id="floating-stream-text">æ¨æµ</span>
	</div>

	<script>
	// æ›´æ–°æµ®åŠ¨æ¨æµæŒ‡ç¤ºå™¨ï¼šä¼˜å…ˆæ£€æµ‹æœ¬é¡µ audio æ’­æ”¾çŠ¶æ€ï¼ˆé€‚é…ä»…ç”¨ <audio> æ’­æ”¾è¿œç«¯æµçš„åœºæ™¯ï¼‰ï¼Œå¦åˆ™å›é€€åˆ°è½®è¯¢ /status
	(function(){
		const dot = () => document.getElementById('floating-stream-dot');
		const txt = () => document.getElementById('floating-stream-text');

		// å¯èƒ½å­˜åœ¨çš„æœ¬åœ° audio å…ƒç´  id åˆ—è¡¨ï¼ˆé¡¹ç›®ä¸­ä½¿ç”¨è¿‡çš„ idï¼‰
		const AUDIO_IDS = ['streamAudio', 'remote-audio-simple', 'remote-audio'];

		function findLocalStreamAudio(){
			for(const id of AUDIO_IDS){
				const a = document.getElementById(id);
				if(a) return a;
			}
			return null;
		}

		function isLocalAudioPlaying(a){
			try{
				if(!a) return false;
				// å¿…é¡»æœ‰ srcï¼Œä¸”æœªæš‚åœï¼Œå¹¶ä¸”å·²å¼€å§‹æ’­æ”¾ï¼ˆcurrentTime>0 æˆ– !paused + readyStateï¼‰
				if(!a.src) return false;
				if(a.paused) return false;
				if(a.readyState > 2) return true;
				// fallback: currentTime > 0 indicates progress
				return a.currentTime > 0;
			}catch(e){
				return false;
			}
		}

		async function updateFromServer(){
			try{
				const resp = await fetch('/status', { cache: 'no-store' });
				if(!resp.ok) throw new Error('status failed');
				const data = await resp.json();
				const meta = data.current_meta || {};
				const url = (meta.url || '').toString().toLowerCase();
				const isStream = meta.type === 'stream' || url.includes('b.joeyz.net') || url.includes('.m3u8');

				if(isStream){
					dot().style.background = '#1db954';
					txt().textContent = (meta.title && meta.title.length>0) ? `æ”¶å¬: ${meta.title}` : 'æ­£åœ¨æ”¶å¬æ¨æµ';
				} else {
					dot().style.background = '#777';
					txt().textContent = 'æ¨æµ';
				}
			}catch(e){
				// é™é»˜å¤±è´¥ï¼šä¸æ”¹å˜ç°æœ‰æ˜¾ç¤º
			}
		}

		async function updateIndicator(){
			const localAudio = findLocalStreamAudio();
			// å¦‚æœæœ¬åœ° audio æ­£åœ¨æ’­æ”¾è¿œç¨‹æµï¼Œä¼˜å…ˆä½¿ç”¨æœ¬åœ°çŠ¶æ€ï¼ˆé€‚é…ä¸é€šè¿‡åç«¯æ’­æ”¾çš„åœºæ™¯ï¼‰
			if(localAudio && isLocalAudioPlaying(localAudio)){
				dot().style.background = '#1db954';
				// æ˜¾ç¤ºæºä¿¡æ¯ï¼ˆå°½é‡ç®€æ´ï¼‰
				const src = (localAudio.src || '').split('?')[0];
				//const friendly = src.includes('b.joeyz.net') ? 'b.joeyz.net æ¨æµ' : (src.split('/').slice(-1)[0] || 'è¿œç«¯æ¨æµ');
				//txt().textContent = `æ”¶å¬: ${friendly}`;
				return;
			}
			// å¦åˆ™å›é€€åˆ°åç«¯ /status
			await updateFromServer();
		}

		// åœ¨ DOM å°±ç»ªåå¯åŠ¨è½®è¯¢
		if(document.readyState === 'loading'){
			document.addEventListener('DOMContentLoaded', () => {
				updateIndicator();
				setInterval(updateIndicator, 2000);
			});
		} else {
			updateIndicator();
			setInterval(updateIndicator, 2000);
		}
	})();
	</script>

	<!-- ä½¿æµ®åŠ¨æ¨æµæŒ‡ç¤ºå™¨å¯äº¤äº’ï¼šç‚¹å‡»æ—¶è§¦å‘è®¾ç½®é¢æ¿ä¸­çš„æµåˆ‡æ¢æŒ‰é’® -->
	<script>
	document.addEventListener('DOMContentLoaded', () => {
		const indicator = document.getElementById('floating-stream-indicator');
		if(!indicator) return;
		indicator.style.cursor = 'pointer';
		indicator.addEventListener('click', () => {
			// ä¼˜å…ˆç›´æ¥è§¦å‘è®¾ç½®é¢æ¿å†…çš„æµåˆ‡æ¢æŒ‰é’®ï¼ˆå­˜åœ¨äºé¡µé¢ä¸Šï¼‰
			const btn = document.getElementById('streamToggleBtn');
			if(btn){
				try{ btn.click(); }catch(e){ /* noop */ }
			}
		});
	});
	</script>

	<!-- History modal -->
	<div id="historyModal" class="history-modal" style="display:none;">
		<div class="history-modal-content">
			<div class="history-modal-header">
				<h3>æ’­æ”¾å†å²</h3>
				<button class="history-modal-close" data-icon="âœ•">âœ•</button>
			</div>
			<div class="history-modal-list" id="historyList"></div>
		</div>
	</div>

	<!-- Local songs modal -->
	<div id="localSongsModal" class="history-modal" style="display:none;">
		<div class="history-modal-content">
			<div class="history-modal-header">
				<h3>æœ¬åœ°æ­Œæ›²</h3>
				<button class="local-songs-modal-close" data-icon="âœ•">âœ•</button>
			</div>
			<div class="history-modal-list" id="localSongsModalBody"></div>
		</div>
	</div>

	<!-- Search Modal -->
	<div id="searchModal" class="search-modal" style="display:none;">
		<div class="search-modal-overlay"></div>
		<div class="search-modal-content">
			<div class="search-modal-header">
				<button class="search-modal-back" id="searchModalBack">âœ•</button>
				<input type="text" id="searchModalInput" class="search-modal-input" placeholder="æœç´¢æ­Œæ›²ã€è‰ºæœ¯å®¶..." autocomplete="off" />
			</div>
			<div id="searchModalHistory" class="search-modal-history" style="display:none;">
				<div id="searchModalHistoryList" class="search-modal-history-list"></div>
				<div class="search-modal-history-actions">
					<button id="searchModalHistoryClear" class="search-modal-history-clear" type="button">
						<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M8 6v12c0 1.1.9 2 2 2h4c1.1 0 2-.9 2-2V6m-5-3h6"></path></svg>
						æ¸…ç©ºå†å²
					</button>
				</div>
			</div>
			<div class="search-modal-body" id="searchModalBody">
				<div class="search-suggestions">
					<div class="search-placeholder">
						<span class="search-placeholder-icon">ğŸ”</span>
						<p>æœç´¢ä¸²æµéŸ³ä¹</p>
					</div>
				</div>
			</div>
		</div>
	</div>


	
	<!-- æ­Œå•é€‰æ‹©æ¨¡æ€æ¡† -->
	<div id="playlistsModal" class="playlists-modal" style="display:none;">
		<div class="playlists-modal-content">
			<div class="playlists-modal-header">
				<!-- <button class="playlists-back-btn" id="playlistsBackBtn">
					<svg width="24" height="24" viewBox="0 0 24 24">
						<path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" fill="currentColor"/>
					</svg>
				</button> -->
				<h2>é€‰æ‹©æ­Œå•</h2>
				<button class="playlists-add-btn" id="playlistsAddBtn">
					<svg width="24" height="24" viewBox="0 0 24 24">
						<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="currentColor"/>
					</svg>
				</button>
			</div>
			<div class="playlists-modal-body" id="playlistsModalBody">
				<!-- æ­Œå•åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
			</div>
		</div>
	</div>

	<!-- ğŸ†• æ­Œå•é€‰æ‹©æ¨¡æ€æ¡† - ç”¨äºæ·»åŠ æ­Œæ›²åˆ°æŒ‡å®šæ­Œå• -->
	<div id="selectPlaylistModal" class="select-playlist-modal" style="display:none;">
		<div class="select-playlist-modal-content">
			<div class="select-playlist-modal-header">
				<h2>é€‰æ‹©æ­Œå•</h2>
				<button class="select-playlist-close-btn" id="selectPlaylistCloseBtn">
					<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<line x1="18" y1="6" x2="6" y2="18"></line>
						<line x1="6" y1="6" x2="18" y2="18"></line>
					</svg>
				</button>
			</div>
			<div class="select-playlist-modal-body" id="selectPlaylistModalBody">
				<!-- æ­Œå•åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
			</div>
			<div class="select-playlist-modal-footer">
				<button class="select-playlist-cancel-btn" id="selectPlaylistCancelBtn">å–æ¶ˆ</button>
			</div>
		</div>
	</div>

	<!-- Debug Modal -->
	<div id="debugModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0a0a0a; display: none; z-index: 9999;">
		<div style="background: #1e1f24; width: 100%; height: 100%; display: flex; flex-direction: column; overflow: hidden;">
			<!-- Header -->
			<div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid #333; flex-shrink: 0; background: #151618;">
				<h3 style="margin: 0; color: #fff; font-size: 18px;">ğŸ› è°ƒè¯•é¢æ¿</h3>
				<button id="debugModalClose" style="background: none; border: none; color: #aaa; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; transition: color 0.2s;">âœ•</button>
			</div>
			
			<!-- Content -->
			<div style="overflow-y: auto; flex: 1; padding: 20px; color: #fff; background: #1e1f24;">
				
				<!-- æ’­æ”¾å™¨çŠ¶æ€ -->
				<div style="margin-bottom: 20px;">
					<h4 style="margin: 0 0 10px 0; color: #51cf66; font-size: 14px; font-weight: bold;">æ’­æ”¾å™¨çŠ¶æ€</h4>
					<div id="debugPlayer" style="background: #0a0a0a; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; color: #51cf66; font-family: 'Courier New', monospace; min-height: 80px; border-left: 3px solid #51cf66;">åŠ è½½ä¸­...</div>
				</div>

				<!-- æ­Œå•ä¿¡æ¯ -->
				<div style="margin-bottom: 20px;">
					<h4 style="margin: 0 0 10px 0; color: #51cf66; font-size: 14px; font-weight: bold;">æ­Œå•ä¿¡æ¯</h4>
					<div id="debugPlaylist" style="background: #0a0a0a; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; color: #51cf66; font-family: 'Courier New', monospace; min-height: 80px; border-left: 3px solid #51cf66;">åŠ è½½ä¸­...</div>
				</div>

				<!-- æœ¬åœ°å­˜å‚¨ -->
				<div style="margin-bottom: 20px;">
					<h4 style="margin: 0 0 10px 0; color: #51cf66; font-size: 14px; font-weight: bold;">æœ¬åœ°å­˜å‚¨</h4>
					<div id="debugStorage" style="background: #0a0a0a; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; color: #51cf66; font-family: 'Courier New', monospace; max-height: 150px; border-left: 3px solid #51cf66;">åŠ è½½ä¸­...</div>
				</div>

				<!-- æ§åˆ¶å°æ—¥å¿— -->
				<div style="margin-bottom: 20px;">
					<h4 style="margin: 0 0 10px 0; color: #51cf66; font-size: 14px; font-weight: bold;">æ§åˆ¶å°æ—¥å¿—</h4>
					<div style="display: flex; gap: 8px; margin-bottom: 10px;">
						<label style="display: flex; align-items: center; gap: 6px; color: #aaa; font-size: 12px; cursor: pointer;">
							<input type="checkbox" id="debugLogToggle" checked style="cursor: pointer;">
							æ•è·æ—¥å¿—
						</label>
					</div>
					<div id="debugLogs" style="background: #0a0a0a; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 11px; color: #51cf66; font-family: 'Courier New', monospace; max-height: 200px; border-left: 3px solid #51cf66; line-height: 1.6;"></div>
				</div>
			</div>
			
			<!-- Footer -->
			<div style="display: flex; gap: 10px; flex-wrap: wrap; padding: 15px 20px; border-top: 1px solid #333; flex-shrink: 0; background: #151618;">
				<button id="debugRefresh" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: background 0.2s;">ğŸ”„ åˆ·æ–°</button>
				<button id="debugClearLogs" style="padding: 8px 16px; background: #ff6b6b; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: background 0.2s;">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
			</div>
		</div>
	</div>



	<script type="module" src="/static/js/main.js?v=18"></script>

	<!-- è°ƒè¯•é¢æ¿æ¨¡å— HTML æ¨¡æ¿ï¼ˆç”± debug-panel.module.js åŠ¨æ€åˆ›å»ºï¼‰ -->
	<template id="debugPanelTemplate">
		<!-- æ¨¡æ¿å†…å®¹ç”± JS æ¨¡å—åŠ¨æ€ç”Ÿæˆ -->
	</template>

	<!-- è®¾ç½®é¢æ¿ -->
	<div id="settingsPanel" class="settings-panel" style="display: none;">
		<!-- è®¾ç½®é¢æ¿èƒŒæ™¯é®ç½© -->
		<div id="settingsMask" class="settings-mask"></div>
		
		<!-- è®¾ç½®é¢æ¿å®¹å™¨ -->
		<div class="settings-container">
			<!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
			<div class="settings-header">
				<h2 class="settings-title">âš™ï¸ è®¾ç½®</h2>
				<button id="settingsCloseBtn" class="settings-close-btn" title="å…³é—­">âœ•</button>
			</div>
			
			<!-- è®¾ç½®å†…å®¹ -->
			<div class="settings-content">
				<!-- ä¸»é¢˜è®¾ç½® -->
				<div class="settings-section">
					<h3 class="section-title">ğŸ¨ å¤–è§‚è®¾ç½®</h3>
					
					<div class="settings-item">
						<label class="settings-label">ä¸»é¢˜æ ·å¼</label>
						<select id="themeSetting" class="settings-select">
							<option value="auto">è‡ªåŠ¨ (æ ¹æ®æ—¶é—´)</option>
							<option value="dark">æ·±è‰²ä¸»é¢˜</option>
							<option value="light">æµ…è‰²ä¸»é¢˜</option>
						</select>
					</div>
					
					<div class="settings-item">
						<label class="settings-label">è¯­è¨€</label>
						<select id="languageSetting" class="settings-select">
							<option value="auto">è‡ªåŠ¨é€‰æ‹©</option>
							<option value="zh">ä¸­æ–‡ (Chinese)</option>
							<option value="en">English</option>
						</select>
					</div>
				</div>
		    <!-- ğŸ› è°ƒè¯•é¢æ¿å…¥å£æŒ‰é’® -->
            <button class="playlists-debug-btn" id="playlistsDebugBtn" title="è°ƒè¯•é¢æ¿" style="margin-left:8px;">
                <span style="font-size:20px;">ğŸ›</span>
            </button>		
	<script type="module">
    // è°ƒè¯•é¢æ¿å…¥å£æŒ‰é’®ç»‘å®š
    document.addEventListener('DOMContentLoaded', () => {
        const debugBtn = document.getElementById('playlistsDebugBtn');
        const debugModal = document.getElementById('debugModal');
        if (debugBtn && debugModal) {
            debugBtn.addEventListener('click', () => {
                debugModal.style.display = 'flex';
            });
        }
    });
	</script>		
			</div>
			
			<!-- æ¨æµæ’­æ”¾æ§åˆ¶ï¼šæ”¾åœ¨æ§åˆ¶é¢æ¿ï¼ˆè®¾ç½®ï¼‰å†… -->
			<div class="settings-section" id="streamingSection" style="margin-top:12px;">
				<h3 class="section-title" data-i18n="settings.streaming">ğŸµ æ¨æµè®¾ç½®</h3>

				<div class="settings-item" style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
					<label class="settings-label" data-i18n="settings.autoStream">æ¥æ”¶æ¨æµ</label>
					<button id="streamToggleBtn" type="button">æ”¶å¬ æ¨æµ</button>
					<span id="streamStatus" style="color:#777;margin-left:8px;">æœªè¿æ¥</span>
				</div>

				<div class="settings-item" style="display:none;align-items:center;gap:8px;margin-bottom:8px;" aria-hidden="true">
					<label class="settings-label">æµåœ°å€</label>
					<input id="streamUrlInput" type="text"
						   value="https://b.joeyz.net//stream.m3u8"
						   style="flex:1;min-width:200px;padding:6px;border-radius:4px;border:1px solid #ccc;display:none;" />
				</div>

				<div class="settings-item" style="display:flex;align-items:center;gap:8px;">
					<label class="settings-label" data-i18n="settings.streamVolume">æ¨æµéŸ³é‡</label>
					<input id="streamVolume" type="range" min="0" max="100" value="80" />
				</div>

				<!-- éšè—çš„ audio å…ƒç´ ç”¨äºåœ¨æœ¬ç«™ç›´æ¥æ’­æ”¾è¿œç«¯æµï¼ˆå¦‚ m3u8ï¼‰ã€‚è‹¥æµè§ˆå™¨ä¸æ”¯æŒåŸç”Ÿ HLSï¼Œé¡µé¢ä¼šå°è¯•ä½¿ç”¨ window.Hlsï¼ˆhls.jsï¼‰ -->
				<audio id="streamAudio" crossorigin="anonymous" controls style="display:none;width:100%;margin-top:8px;"></audio>
			</div>

			<script>
			(function(){
				const STREAM_DEFAULT = 'https://b.joeyz.net//stream.m3u8';
				const btn = document.getElementById('streamToggleBtn');
				const status = document.getElementById('streamStatus');
				const urlInput = document.getElementById('streamUrlInput');
				const audio = document.getElementById('streamAudio');
				const vol = document.getElementById('streamVolume');
				let playing = false;
				let hls = null;

				async function startStream(url){
					try{
						// å¦‚æœæµè§ˆå™¨æ”¯æŒ Hls.js ä¸” Hls å¯ç”¨ï¼Œä¼˜å…ˆä½¿ç”¨ hls.jsï¼ˆæ’­æ”¾ m3u8ï¼‰
						if (window.Hls && Hls.isSupported()){
							if (hls){ hls.destroy(); hls = null; }
							hls = new Hls();
							hls.loadSource(url);
							hls.attachMedia(audio);
						} else {
							// ç›´æ¥è®¾ç½® srcï¼ˆSafari åŸç”Ÿæ”¯æŒ m3u8ï¼‰
							audio.src = url;
						}
						audio.volume = (parseInt(vol.value,10) || 80) / 100;
						audio.style.display = 'block';
						await audio.play().catch(()=>{ /* play may be blocked until user gesture; this click is a gesture */ });
						status.textContent = 'æ­£åœ¨æ”¶å¬';
						btn.textContent = 'åœæ­¢æ”¶å¬';
						playing = true;
					}catch(err){
						console.warn('stream start failed', err);
						status.textContent = 'è¿æ¥å¤±è´¥';
					}
				}

				function stopStream(){
					try{
						audio.pause();
						audio.removeAttribute('src');
						audio.load();
						audio.style.display = 'none';
						if (hls){
							try{ hls.destroy(); }catch(_){} finally{ hls = null; }
						}
					}catch(e){}
					status.textContent = 'æœªè¿æ¥';
					btn.textContent = 'æ”¶å¬ æ¨æµ';
					playing = false;
				}

				btn.addEventListener('click', async () => {
					const url = (urlInput.value || STREAM_DEFAULT).trim();
					if (!playing){
						await startStream(url);
					} else {
						stopStream();
					}
				});

				vol.addEventListener('input', () => {
					try{ audio.volume = (parseInt(vol.value,10)||80)/100; }catch(e){}
				});

				window.addEventListener('beforeunload', () => {
					try{ stopStream(); }catch(e){}
				});
			})();
			</script>
		
			<!-- åº•éƒ¨æ“ä½œæ  -->
			<div class="settings-footer">
			</div>
		</div>
	</div>

	<!-- ç¦æ­¢ç¼©æ”¾è„šæœ¬ -->
	<script>
		// ç¦æ­¢ Safari åŒæŒ‡æ”¾å¤§
		document.addEventListener('gesturestart', function(e) {
			e.preventDefault();
		});
		
		// ç¦æ­¢ touchmove åŒæŒ‡æ”¾å¤§
		let lastTouchDistance = 0;
		document.addEventListener('touchmove', function(e) {
			if (e.touches.length === 2) {
				e.preventDefault();
			}
		}, { passive: false });
		
		// ç¦æ­¢åŒå‡»æ”¾å¤§
		let lastTapTime = 0;
		document.addEventListener('touchend', function(e) {
			const currentTime = new Date().getTime();
			const tapLength = currentTime - lastTapTime;
			if (tapLength < 300 && tapLength > 0) {
				e.preventDefault();
			}
			lastTapTime = currentTime;
		}, { passive: false });
	</script>

</body>
</html>